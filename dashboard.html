<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1.0">
    <title>Dashboard</title>

    <!-- Montserrat Font -->
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@100;200;300;400;500;600;700;800;900&display=swap" rel="stylesheet">

    <!-- Material Icons -->
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons+Outlined" rel="stylesheet">
   
    <!-- Line Graph -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <!-- Custom CSS -->
    <link rel="stylesheet" href="css/styles.css">

    <!-- Fade-in Animation CSS -->
    <style>
      /* Fade-in animation */
      @keyframes fadeIn {
        from {
          opacity: 0;
        }
        to {
          opacity: 1;
        }
      }

      /* Apply the animation to the body */
      .fade-in {
        animation: fadeIn 1s ease-in-out; /* 1 second duration */
      }
    </style>
  </head>
  <body>
    <div class="grid-container">

      <!-- Header -->
      <header class="header">
        <div class="menu-icon" onclick="openSidebar()">
          <span class="material-icons-outlined">menu</span>
        </div>
        <div class="main-title">
          <h2>DASHBOARD</h2>
        </div>
      </header>
      <!-- End Header -->

      <!-- Sidebar -->
      <aside id="sidebar">
        <div class="sidebar-title">
          <div class="sidebar-brand">
          </div>
          <span class="material-icons-outlined" onclick="closeSidebar()">close</span>
        </div>

        <ul class="sidebar-list">
          <li class="sidebar-list-item">
            <a href="dashboard.html">
              <span class="material-icons-outlined">poll</span> Dashboard
            </a>
          </li>
          <li class="sidebar-list-item">
            <!-- Link to farmers.html -->
            <a href="farmers.html">
              <span class="material-icons-outlined">groups</span> Farmers
            </a>
          </li>
          
          <li class="sidebar-list-item">
            <a href="info.html">
              <span class="material-icons-outlined">info</span> Info
            </a>
          </li>
          <li class="sidebar-list-item-logout">
            <a href="index.html">
              <span class="material-icons-outlined">logout</span> Logout
            </a>
          </li>          
        </ul>
      </aside>
      <!-- End Sidebar -->

      <main class="main-container">
        <div class="main-cards">
          <div class="card">
            <div class="card-inner">
              <h3>Total Farmers</h3>
              <span class="material-icons-outlined">person</span>
            </div>
            <h1>249</h1>
          </div>

          <div class="card">
            <div class="card-inner">
              <h3>Predicted Yield</h3>
              <span class="material-icons-outlined">grass</span>
            </div>
            <h1>56</h1>
          </div>  
        </div>
      </main>

      <canvas id="myLineChart"></canvas>

      <canvas id="myPieChart"></canvas>

      <div class="button-container">
        <button class="my-button">Update Yeild</button>
    </div>    

      <!-- End Main -->

    </div>
    
    <header class="header">
      <div class="menu-icon" onclick="openSidebar()">
        <span class="material-icons-outlined"></span>
      </div>
      <div class="main-title">
        <img src="../assets/logo.png" alt="Logo" class="logo">
      </div>
    </header>

    <script>
      document.addEventListener("DOMContentLoaded", function() {
          // Add fade-in effect
          document.body.classList.add("fade-in");
      });
    </script>   

<script>
  // Get the canvas element
const ctx = document.getElementById('myLineChart').getContext('2d');

// Fetch data from the API
fetch('http://localhost:3000/api/data')
  .then(response => response.json())
  .then(data => {
    // Map the fetched data to chart format
    const labels = data.map(item => item.Date); // X-axis labels (dates)
    const yieldData = data.map(item => item.Yield_kg_per_hectare); // Y-axis data (yield per hectare)

    // Create the line chart with the fetched data
    const myLineChart = new Chart(ctx, {
      type: 'line',
      data: {
        labels: labels,  // X-axis labels (dates)
        datasets: [{
          label: 'Yield per Month',
          data: yieldData, // Y-axis data (yield per hectare)
          borderColor: 'blue',
          backgroundColor: 'rgba(0, 0, 255, 0.2)', // Fill color for the area
          borderWidth: 2,
          tension: 0.3 // Makes the line smooth
        }]
      },
      options: {
        responsive: true,
        maintainAspectRatio: false,
        plugins: {
          title: {
            display: true,
            text: 'Historical Data of Crops Yield', // Title text
            font: {
              size: 18, // Font size
              weight: 'bold' // Font weight
            },
            padding: {
              top: 10,
              bottom: 20
            }
          }
        },
        scales: {
          x: {
            title: { display: true, text: 'Date' }
          },
          y: {
            title: { display: true, text: 'Yield (kg/hectare)' },
            beginAtZero: true
          }
        }
      }
    });
  })
  .catch(error => console.error('Error fetching data:', error));
</script>

<script>
  // Get the canvas element
  const ctxPie = document.getElementById('myPieChart').getContext('2d');

  const myPieChart = new Chart(ctxPie, {
    type: 'pie',
    data: {
        labels: ['Rice', 'Corn', 'Wheat', 'Soybeans'],
        datasets: [{
            data: [40, 30, 15, 15],
            backgroundColor: ['red', 'blue', 'green', 'yellow'],
        }]
    },
    options: {
        responsive: true,
        maintainAspectRatio: false, // Allows resizing
        plugins: {
            legend: {
                display: true, // Show labels
                position: 'bottom',
                labels: {
                    padding: 0, // Remove padding around text
                    font: {
                        size: 14
                    }
                }
            }
        },
        // Remove extra padding
        layout: {
            padding: 0
        },
        // Increase quality on high-resolution screens
        devicePixelRatio: window.devicePixelRatio > 1 ? 2 : 1
    }
  });
</script>

</script>
</body>
</html>
