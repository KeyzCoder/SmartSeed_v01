<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1.0">
    <title>Farmer</title>

    <!-- Montserrat Font -->
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@100;200;300;400;500;600;700;800;900&display=swap" rel="stylesheet">

    <!-- Material Icons -->
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons+Outlined" rel="stylesheet">

    <!-- Custom CSS -->
    <link rel="stylesheet" href="css/farmers.css">

    <!-- Fade-in Animation CSS -->
    <style>
      @keyframes fadeIn {
        from { opacity: 0; }
        to { opacity: 1; }
      }
      .fade-in {
        animation: fadeIn 1s ease-in-out;
      }
    </style>
  </head>
  <body>
    <div class="grid-container">
      <!-- Header -->
      <header class="header">
        <div class="menu-icon" onclick="openSidebar()">
          <span class="material-icons-outlined">menu</span>
        </div>
        <div class="main-title">
          <h2>Farmers</h2>
        </div>
      </header>
      <!-- End Header -->

      <!-- Farmers Table -->
      <div class="container">
        <table id="farmersTable">
          <thead>
            <tr>
              <th>Name</th>
              <th>Location</th>
              <th>Crop Type</th>
              <th>Phone Number</th>
              <th>Farm Size</th>
            </tr>
          </thead>
          <tbody id="farmersTableBody">
            <!-- Data rows will be injected here -->
          </tbody>
        </table>
      </div>

      <!-- Buttons -->
      <div class="button-container">
        <button class="my-button">Add Farmer</button>
      </div>    
      <div class="red-button-container">
        <button class="my-button-red">Delete Farmer</button>
      </div>
      <div class="gray-button-container">
        <button class="my-button-gray">Edit Farmer</button>
      </div>
      <div class="dark-button-container">
        <button class="my-button-dark">Print</button>
      </div>

      <!-- Sidebar -->
      <aside id="sidebar">
        <div class="sidebar-title">
          <div class="sidebar-brand"></div>
          <span class="material-icons-outlined" onclick="closeSidebar()">close</span>
        </div>
        <ul class="sidebar-list">
          <li class="sidebar-list-item">
            <a href="dashboard.html">
              <span class="material-icons-outlined">poll</span> Dashboard
            </a>
          </li>
          <li class="sidebar-list-item">
            <a href="farmers.html">
              <span class="material-icons-outlined">groups</span> Farmers
            </a>
          </li>
          <li class="sidebar-list-item">
            <a href="info.html">
              <span class="material-icons-outlined">info</span> Info
            </a>
          </li>
          <li class="sidebar-list-item-logout">
            <a href="index.html">
              <span class="material-icons-outlined">logout</span> Logout
            </a>
          </li>          
        </ul>
      </aside>
      <!-- End Sidebar -->

      <!-- Filter Section -->
      <div class="filter-container">
        <label for="nameSort">Sort by Name:</label>
        <select id="nameSort">
          <option value="all">All</option>
          <option value="A-Z">A-Z</option>
          <option value="Z-A">Z-A</option>
        </select>

        <!-- If you intended to filter by first letter, add a select for it -->
        <label for="nameFilter"></label>
        <select id="nameFilter">
          <option value="all">All</option>
          <!-- Options will be populated dynamically -->
        </select>

        <label for="locationFilter">Filter by Location:</label>
          <select id="locationFilter">
            <option value="all">All</option>
            <option value="santiago">Santiago</option>
            <option value="ilagan">Ilagan</option>
            <option value="roxas">Roxas</option>
            <option value="cauayan">Cauayan</option>
            <option value="tumauini">Tumauini</option>
            <option value="cabagan">Cabagan</option>
            <option value="san_mariano">San Mariano</option>
            <option value="alicia">Alicia</option>
            <option value="san_mateo">San Mateo</option>
            <option value="echague">Echague</option>
            <option value="gamu">Gamu</option>
            <option value="angadanan">Angadanan</option>
            <option value="san_pablo">San Pablo</option>
            <option value="mallig">Mallig</option>
            <option value="reina_mercedes">Reina Mercedes</option>
            <option value="quirino">Quirino</option>
            <option value="delfin_albano">Delfin Albano</option>
            <option value="san_agustin">San Agustin</option>
            <option value="san_isidro">San Isidro</option>
            <option value="benito_soliven">Benito Soliven</option>
          </select>


          <label for="cropTypeFilter">Filter by Crop Type:</label>
          <select id="cropTypeFilter">
            <option value="all">All</option>
            <option value="jasmine rice">Jasmine Rice</option>
            <option value="dinorado rice">Dinorado Rice</option>
            <option value="black rice">Black Rice</option>
            <option value="glutinous rice">Glutinous Rice</option>
            <option value="ir64 rice">IR64 Rice</option>
            <option value="fancy rice">Fancy Rice</option>
            <option value="japonica rice">Japonica Rice</option>
            <option value="basmati rice">Basmati Rice</option>
            <option value="long grain rice">Long Grain Rice</option>
            <option value="hybrid rice">Hybrid Rice</option>
          </select>          

        <label for="farmSizeFilter">Filter by Farm Size:</label>
        <select id="farmSizeFilter">
          <option value="all">All</option>
          <option value="small">Small</option>
          <option value="medium">Medium</option>
          <option value="large">Large</option>
        </select>

        <!-- Only one search input -->
        <input type="text" class="search-bar" placeholder="Search..." id="searchInput">
      </div>

    </div>

    <header class="header">
      <div class="menu-icon" onclick="openSidebar()">
        <span class="material-icons-outlined"></span>
      </div>
      <div class="main-title">
        <img src="assets/logo.png" alt="Logo" class="logo">
      </div>
    </header>

    <!-- Scripts -->
    <script>
      document.addEventListener("DOMContentLoaded", function() {
        // Apply fade-in effect
        document.body.classList.add("fade-in");
      });
    </script>
    
    <!-- Search Section -->
<div class="search-container">
  <label for="searchInput">Search by Name:</label>
  <input type="text" id="searchInput" placeholder="Search...">
</div>

<!-- Scripts -->
<script>
document.addEventListener("DOMContentLoaded", function () {
  let farmersData = [];

  fetch('http://localhost:3000/api/farmers')
    .then(response => response.json())
    .then(data => {
      console.log("Farmers data:", data);
      farmersData = data;
      populateTable(farmersData);
      populateFilterOptions(farmersData); // for name filtering if needed
      populateLocationFilter(farmersData);  // populate cities dropdown
    })
    .catch(error => console.error("Error fetching farmers data:", error));

  function populateTable(data) {
    const tbody = document.getElementById('farmersTableBody');
    tbody.innerHTML = "";
    data.forEach(farmer => {
      const row = document.createElement('tr');
      row.innerHTML = `
        <td>${farmer["Name"] || ''}</td>
        <td>${farmer["Location"] || ''}</td>
        <td>${farmer["Crop Type"] || ''}</td>
        <td>${farmer["Phone Number"] || ''}</td>
        <td>${farmer["Farm Size"] || ''}</td>
      `;
      tbody.appendChild(row);
    });
  }

  function populateFilterOptions(data) {
    const nameFilter = document.getElementById('nameFilter');
    const firstLetters = [...new Set(data.map(farmer => farmer["Name"]?.charAt(0).toUpperCase()).sort())];
    nameFilter.innerHTML = '<option value="all">All</option>';
    firstLetters.forEach(letter => {
      nameFilter.innerHTML += `<option value="${letter}">${letter}</option>`;
    });
  }

  function populateLocationFilter(data) {
    const locationFilter = document.getElementById('locationFilter');
    const locations = [...new Set(
      data.map(farmer => farmer["Location"]?.trim()).filter(Boolean)
    )];
    locations.sort((a, b) => a.localeCompare(b));
    locationFilter.innerHTML = '<option value="all">All</option>';
    locations.forEach(loc => {
      locationFilter.innerHTML += `<option value="${loc.toLowerCase()}">${loc}</option>`;
    });
  }

  document.getElementById('nameSort').addEventListener('change', function () {
    let sortedData = [...farmersData];
    const sortOrder = this.value;
    if (sortOrder === 'A-Z') {
      sortedData.sort((a, b) => a["Name"].localeCompare(b["Name"]));
    } else if (sortOrder === 'Z-A') {
      sortedData.sort((a, b) => b["Name"].localeCompare(a["Name"]));
    }
    populateTable(sortedData);
  });

  document.getElementById('nameFilter').addEventListener('change', function () {
    const selectedLetter = this.value;
    const filteredData = selectedLetter === "all" 
      ? farmersData 
      : farmersData.filter(farmer => farmer["Name"].startsWith(selectedLetter));
    populateTable(filteredData);
  });

  document.getElementById('locationFilter').addEventListener('change', function () {
  const selectedLocation = this.value; // e.g., "santiago"
  const filteredData = selectedLocation === "all" 
    ? farmersData 
    : farmersData.filter(farmer => 
        farmer["Location"] && farmer["Location"].trim().toLowerCase() === selectedLocation
      );
  populateTable(filteredData);
});

document.getElementById('farmSizeFilter').addEventListener('change', function () {
  const selectedFarmSize = this.value.toLowerCase(); // Convert to lowercase for case-insensitive comparison
  const filteredData = selectedFarmSize === "all" 
    ? farmersData 
    : farmersData.filter(farmer => {
        const farmSize = parseFloat(farmer["Farm Size"]);
        if (isNaN(farmSize)) return false;
        if (selectedFarmSize === "small" && farmSize <= 3) return true;
        if (selectedFarmSize === "medium" && farmSize > 3 && farmSize <= 6) return true;
        if (selectedFarmSize === "large" && farmSize > 6) return true;
        return false;
      });
  populateTable(filteredData);
});


document.getElementById('cropTypeFilter').addEventListener('change', function () {
  const selectedCropType = this.value.toLowerCase(); // Convert to lowercase for case-insensitive comparison
  const filteredData = selectedCropType === "all" 
    ? farmersData 
    : farmersData.filter(farmer => 
        farmer["Crop Type"] && farmer["Crop Type"].toLowerCase() === selectedCropType
      );
  populateTable(filteredData);
});


  document.getElementById('searchInput').addEventListener('input', function () {
    const searchTerm = this.value.toLowerCase();
    const filteredData = farmersData.filter(farmer => 
      farmer["Name"] && farmer["Name"].toLowerCase().includes(searchTerm)
    );
    populateTable(filteredData);
  });
});
</script>

    
    
    <!-- Optional: Guard event listener for non-existent element -->
    <script>
      document.addEventListener("DOMContentLoaded", function() {
        let container = document.getElementById('resize-container');
        if (container) {
          let isDragging = false;
          let offsetX = 0;
          let offsetY = 0;
    
          container.addEventListener('mousedown', function (e) {
            isDragging = true;
            offsetX = e.clientX - container.getBoundingClientRect().left;
            offsetY = e.clientY - container.getBoundingClientRect().top;
          });
    
          document.addEventListener('mousemove', function (e) {
            if (isDragging) {
              container.style.left = e.clientX - offsetX + 'px';
              container.style.top = e.clientY - offsetY + 'px';
            }
          });
    
          document.addEventListener('mouseup', function () {
            isDragging = false;
          });
        }
      });
    </script>
    
  </body>
</html>
